
![image](https://github.com/magnate3/linux-riscv-dev/blob/main/exercises/lru/lru1.png)

# insmod  lru_test0.ko 


![image](https://github.com/magnate3/linux-riscv-dev/blob/main/exercises/lru/lru2.png)

```
[root@centos7 lru]# dmesg | tail -n 40
[ 6966.063281] ========== LRU_ACTIVE_FILE ============
[ 6966.068138] ========== LRU_ACTIVE_FILE ============
[ 7092.705619] ========== LRU_ACTIVE_FILE ============
[ 7092.710488] ========== LRU_ACTIVE_FILE ============
[ 7092.715345] ========== LRU_ACTIVE_FILE ============
[ 7092.720207] ========== LRU_ACTIVE_FILE ============
[ 7175.526055] ========== LRU_ACTIVE_FILE ============
[ 7175.530913] (3ff76c) (3ff76c) (3ff76c) (3ff76c) (3ff76c) (3ff76c) (3ff76c) (3ff76c) (3ff76c) (3ff76c) (3ff76c) (3ff76c) (3ff76c) (3ff76c) (3ff76c) (3ff76c) (3ff76c) (3ff76c) (3ff76c) 
[ 7175.530924] ========== LRU_INACTIVE_FILE ============
[ 7175.552209] (3ff795) (3ff795) (3ff795) (3ff795) (3ff795) (3ff795) (3ff795) (3ff795) (3ff795) (3ff795) (3ff795) (3ff795) (3ff795) (3ff795) (3ff795) (3ff795) (3ff795) (3ff795) (3ff795) 
[ 7175.552219] ========== LRU_ACTIVE_ANON ============
[ 7175.573334] (3ff605) (3ff605) (3ff605) (3ff605) (3ff605) (3ff605) (3ff605) (3ff605) (3ff605) (3ff605) (3ff605) (3ff605) (3ff605) (3ff605) (3ff605) (3ff605) (3ff605) (3ff605) (3ff605) 
[ 7175.573344] ========== LRU_INACTIVE_ANON ============
[ 7175.594629] (3ff62b) (3ff62b) (3ff62b) (3ff62b) (3ff62b) (3ff62b) (3ff62b) (3ff62b) (3ff62b) (3ff62b) (3ff62b) (3ff62b) (3ff62b) (3ff62b) (3ff62b) (3ff62b) (3ff62b) (3ff62b) (3ff62b) 
[ 7175.594639] ========== LRU_UNEVICTABLE ============
[ 7175.615763] ========== LRU_ACTIVE_FILE ============
[ 7175.620618] (5ff724) (5ff724) (5ff724) (5ff724) (5ff724) (5ff724) (5ff724) (5ff724) (5ff724) (5ff724) (5ff724) (5ff724) (5ff724) (5ff724) (5ff724) (5ff724) (5ff724) (5ff724) (5ff724) 
[ 7175.620629] ========== LRU_INACTIVE_FILE ============
[ 7175.641915] (5ff760) (5ff760) (5ff760) (5ff760) (5ff760) (5ff760) (5ff760) (5ff760) (5ff760) (5ff760) (5ff760) (5ff760) (5ff760) (5ff760) (5ff760) (5ff760) (5ff760) (5ff760) (5ff760) 
[ 7175.641925] ========== LRU_ACTIVE_ANON ============
[ 7175.663037] (5ff74c) (5ff74c) (5ff74c) (5ff74c) (5ff74c) (5ff74c) (5ff74c) (5ff74c) (5ff74c) (5ff74c) (5ff74c) (5ff74c) (5ff74c) (5ff74c) (5ff74c) (5ff74c) (5ff74c) (5ff74c) (5ff74c) 
[ 7175.663047] ========== LRU_INACTIVE_ANON ============
[ 7175.684332] (5ff439) (5ff439) (5ff439) (5ff439) (5ff439) (5ff439) (5ff439) (5ff439) (5ff439) (5ff439) (5ff439) (5ff439) (5ff439) (5ff439) (5ff439) (5ff439) (5ff439) (5ff439) (5ff439) 
[ 7175.684342] ========== LRU_UNEVICTABLE ============
[ 7175.705459] ========== LRU_ACTIVE_FILE ============
[ 7175.710314] ========== LRU_INACTIVE_FILE ============
[ 7175.715341] ========== LRU_ACTIVE_ANON ============
[ 7175.720196] (203ff740) (203ff740) (203ff740) (203ff740) (203ff740) (203ff740) (203ff740) (203ff740) (203ff740) (203ff740) (203ff740) (203ff740) (203ff740) (203ff740) (203ff740) (203ff740) (203ff740) (203ff740) (203ff740) 
[ 7175.720207] ========== LRU_INACTIVE_ANON ============
[ 7175.744776] (203ff73f) (203ff73f) (203ff73f) (203ff73f) (203ff73f) (203ff73f) (203ff73f) (203ff73f) (203ff73f) (203ff73f) (203ff73f) (203ff73f) (203ff73f) (203ff73f) (203ff73f) (203ff73f) (203ff73f) (203ff73f) (203ff73f) 
[ 7175.744786] ========== LRU_UNEVICTABLE ============
[ 7175.769187] ========== LRU_ACTIVE_FILE ============
[ 7175.774043] (205ff103) (205ff103) (205ff103) (205ff103) (205ff103) (205ff103) (205ff103) (205ff103) (205ff103) (205ff103) (205ff103) (205ff103) (205ff103) (205ff103) (205ff103) (205ff103) (205ff103) (205ff103) (205ff103) 
[ 7175.774053] ========== LRU_INACTIVE_FILE ============
[ 7175.798622] (205ff1c7) (205ff1c7) (205ff1c7) (205ff1c7) (205ff1c7) (205ff1c7) (205ff1c7) (205ff1c7) (205ff1c7) (205ff1c7) (205ff1c7) (205ff1c7) (205ff1c7) (205ff1c7) (205ff1c7) (205ff1c7) (205ff1c7) (205ff1c7) (205ff1c7) 
[ 7175.798632] ========== LRU_ACTIVE_ANON ============
[ 7175.823028] (205ff74c) (205ff74c) (205ff74c) (205ff74c) (205ff74c) (205ff74c) (205ff74c) (205ff74c) (205ff74c) (205ff74c) (205ff74c) (205ff74c) (205ff74c) (205ff74c) (205ff74c) (205ff74c) (205ff74c) (205ff74c) (205ff74c) 
[ 7175.823038] ========== LRU_INACTIVE_ANON ============
[ 7175.847607] (205ff495) (205ff495) (205ff495) (205ff495) (205ff495) (205ff495) (205ff495) (205ff495) (205ff495) (205ff495) (205ff495) (205ff495) (205ff495) (205ff495) (205ff495) (205ff495) (205ff495) (205ff495) (205ff495) 
[ 7175.847617] ========== LRU_UNEVICTABLE ============
[root@centos7 lru]# 
```

# 页面回收

![image](https://github.com/magnate3/linux-riscv-dev/blob/main/exercises/lru/lru3.jpg)


文件页：对应磁盘文件读到memory后暂存的页。下次再去读取磁盘里面的内容时，直接读取page_cache即可，
所以，当memory不够用时，可以将这些page_cache drop，或者将脏的page_cache 回写磁盘，之后free 相应page。

匿名页：简单点说就是没有文件背景的内存，比如stack，heap，cow后的数据，
这些数据都是申请了以后常驻在内存memory中的，如果长时间不使用它们，并且内存不足的时候，
可以将他们暂存在磁盘中的swap分区，然后释放内存。
等用到它们的时候，发生缺页异常再将它们搬回memory中即可。