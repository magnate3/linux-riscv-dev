# Trace Generator Documentation

## Introduction

The trace generator generates a traffic trace file, which describes how to send traffic within the Mininet. The outputed trace file, will be read by the traffic generator, and the traffic generator will send the traffic based on the description of the trace file.

Now the traffic generator supports iperf traffic and memcached traffic. We could extend the traffic type to more in the future.

## Usage

```
usage: generate_trace.py [config json file]
```

The trace generator is configured using a JSON file. The JSON file should be formatted as follows

```
  {
    "flow_groups": [
      {
        "start_time": 0,
        "length": 10000000,
        "src_host_list": ["h1", "h2", "h3"],
        "dst_host_list": ["h2", "h3"],
        "flow_size_distribution": {
            "type": "uniform",
            "min": 1000000,
            "max": 8000000
        },
        "flow_gap_distribution": {
            "type": "uniform",
            "min": 300000,
            "max": 1700000
        },
        "flowlet_size_distribution": {
            "type": "constant",
            "value": 10000
        },
        "flowlet_gap_distribution": {
            "type": "constant",
            "value": 3000
        },
        {
          ...
        }
      }
    ],
    "mc_host_list": ["h1", "h2"],
    "mc_gap_distribution": {
        "type": "constant",
        "value": 100000
    },
    "length": 60000000,
    "output": "sample.trace"
  }
```

You can check `sample.json` for reference.

We explain each field as follows.

### Flow Group

Iperf traffic is describe as a list of flow groups. Each flow group is sent independently. Each flow group is described by the following fields:

- `start_time`. This option describes the starting time to send this flow group. The unit is us. The starting time is a relative timestamp compared with the starting time of running the traffic generator.
- `length`. This option describes the total time to send the flow group. The time interval of this flow group should be [start_time, start_time + length).
- `src_host_list`. This option describes the list of host names as the sender of the iperf traffic.
- `dst_host_list`. This option describes the list of host names as the receiver of the iperf traffic.
- `flow_size_distribution`. This option describes the flow size distribution of all the iperf flows within this flow group. Here we can use two types of distributions: constant distribution and uniform distribution.
- `flow_gap_distribution`. This option describes the distribution of inter-flow gaps. Here the inter-flow gap is defined as the difference of the starting time of two adjacent flows.
- `flowlet_size_distribution`. This option describes the flowlet size distribution. Here we only support constant distribution, i.e., the flowlet size is a the same for all iperf flows.
- `flowlet_gap_distribution`. This option describes the inter-flowlet gap distribution. Here the inter-flowlet gap is defined as the difference of the ending time of the first flowlet, and the starting time of the second flowlet.

Each flow group is generated by the trace generator in the following way. The trace generator starts to create an iperf flow, randomly select a sending host from `src_host_list`, and a receiving host from `dst_host_list`. Note that the sending host should be different fro the receiving host.
Then the trace generator determines a flow size based on the flow size distribution, and determines a flowlet size and a flowlet gap size in the same way.
Now this iperf flow is successfully created.
Then the trace generator determines the starting time of the next iperf flow, by determining a flow gap based on the flow gap distribution.
